package.path=package.path..";../Samples/ysscripts/lib/?.lua" --;"..package.path
require("utilfunc")

package.path=package.path..";../Samples/ysscripts/samples/?.lua" --;"..package.path
require("useMuscle_full_same")


useCases.full_sit_repeat=deepCopyTable(useCases.full_same)

useCases.full_sit_repeat.optimizerMethod='Optimizer.methods.CMAes_ys'

useCases.full_sit_repeat.endSegW=10
useCases.full_sit_repeat.prec=.2

useCases.full_sit_repeat.modelName='full_sit_repeat'
useCases.full_sit_repeat.grpName='full_sit_repeat'
useCases.full_sit_repeat.grpNames={'full_sit_repeat'}

--useCases.full_sit_repeat.ddqObjWeight=100000*(25-7)
useCases.full_sit_repeat.ddqObjWeight=10000000*(25-7)

-- the initial pendControlParam and pendOptimizationPath can be automatically generated by using createInitialPendControlParam.lua
useCases.full_sit_repeat.pendControlParam=
{
['keyframe,0,pendDesiredVel,full_sit_repeat,l,z']=0,['keyframe,0,pendDesiredVel,full_sit_repeat,l,x']=1,['keyframe,0,pendDesiredVel,full_sit_repeat,r,z']=0,['keyframe,0,pendDesiredVel,full_sit_repeat,r,x']=1,['keyframe,0,pendDesiredVel,full_sit_repeat,L1,z']=0,['keyframe,0,pendDesiredVel,full_sit_repeat,L1,x']=1,['keyframe,0,pendDesiredVel,full_sit_repeat,R1,z']=0,['keyframe,0,pendDesiredVel,full_sit_repeat,R1,x']=1,['keyframe,0,pendDesiredVel,full_sit_repeat,L2,z']=0,['keyframe,0,pendDesiredVel,full_sit_repeat,L2,x']=1,['keyframe,0,pendDesiredVel,ignore,0,z']=0,['keyframe,0,pendDesiredVel,ignore,0,x']=1,['keyframe,0,pendDesiredVel,ignore,1,z']=0,['keyframe,0,pendDesiredVel,ignore,1,x']=1,
['keyframe,0,pendDesiredVel,ignore,0,x']=0.63083401770448, ['keyframe,0,pendDesiredVel,ignore,0,z']=-0.38196622161619, ['keyframe,0,pendDesiredVel,full_sit_repeat,l,x']=0.3154640943164, ['keyframe,0,pendDesiredVel,full_sit_repeat,l,z']=-0.11612750942994, ['keyframe,0,pendDesiredVel,full_sit_repeat,r,x']=0.15359641496264, ['keyframe,0,pendDesiredVel,full_sit_repeat,r,z']=0.004415137136395, ['keyframe,0,pendDesiredVel,full_sit_repeat,L1,x']=0.093043867540163, ['keyframe,0,pendDesiredVel,full_sit_repeat,L1,z']=0.046960816589247, ['keyframe,0,pendDesiredVel,full_sit_repeat,R1,x']=0.11896745918515, ['keyframe,0,pendDesiredVel,full_sit_repeat,R1,z']=0.028965363759542, ['keyframe,0,pendDesiredVel,full_sit_repeat,L2,x']=0.14217363816635, ['keyframe,0,pendDesiredVel,full_sit_repeat,L2,z']=0.060396037678439, ['keyframe,0,pendDesiredVel,ignore,1,x']=0.16595948542659, ['keyframe,0,pendDesiredVel,ignore,1,z']=0.048642269435213, 
['keyframe,0,pendDesiredVel,ignore,0,x']=0.62965083440742, ['keyframe,0,pendDesiredVel,ignore,0,z']=-0.38227293012794, ['keyframe,0,pendDesiredVel,full_sit_repeat,l,x']=0.31468427561919, ['keyframe,0,pendDesiredVel,full_sit_repeat,l,z']=-0.11682405226642, ['keyframe,0,pendDesiredVel,full_sit_repeat,r,x']=0.15279294849331, ['keyframe,0,pendDesiredVel,full_sit_repeat,r,z']=0.0041254927396511, ['keyframe,0,pendDesiredVel,full_sit_repeat,L1,x']=0.092641777369002, ['keyframe,0,pendDesiredVel,full_sit_repeat,L1,z']=0.046540871143208, ['keyframe,0,pendDesiredVel,full_sit_repeat,R1,x']=0.11862170412077, ['keyframe,0,pendDesiredVel,full_sit_repeat,R1,z']=0.028812544573571, ['keyframe,0,pendDesiredVel,full_sit_repeat,L2,x']=0.14201975377441, ['keyframe,0,pendDesiredVel,full_sit_repeat,L2,z']=0.060328537120663, ['keyframe,0,pendDesiredVel,ignore,1,x']=0.1657885835502, ['keyframe,0,pendDesiredVel,ignore,1,z']=0.048660760656339, 
['keyframe,0,pendDesiredVel,ignore,0,x']=0.62963850263583, ['keyframe,0,pendDesiredVel,ignore,0,z']=-0.38227603346691, ['keyframe,0,pendDesiredVel,full_sit_repeat,l,x']=0.31467623002857, ['keyframe,0,pendDesiredVel,full_sit_repeat,l,z']=-0.116831203247, ['keyframe,0,pendDesiredVel,full_sit_repeat,r,x']=0.15278475165127, ['keyframe,0,pendDesiredVel,full_sit_repeat,r,z']=0.0041224303338188, ['keyframe,0,pendDesiredVel,full_sit_repeat,L1,x']=0.092637785240243, ['keyframe,0,pendDesiredVel,full_sit_repeat,L1,z']=0.046536567020841, ['keyframe,0,pendDesiredVel,full_sit_repeat,R1,x']=0.11861814734488, ['keyframe,0,pendDesiredVel,full_sit_repeat,R1,z']=0.028810868784772, ['keyframe,0,pendDesiredVel,full_sit_repeat,L2,x']=0.14201799057691, ['keyframe,0,pendDesiredVel,full_sit_repeat,L2,z']=0.060327860356356, ['keyframe,0,pendDesiredVel,ignore,1,x']=0.1657864100854, ['keyframe,0,pendDesiredVel,ignore,1,z']=0.048660987521246, 
['keyframe,0,pendDesiredVel,ignore,0,x']=0.94445494063114, ['keyframe,0,pendDesiredVel,ignore,0,z']=-0.80592324958188, ['keyframe,0,pendDesiredVel,full_sit_repeat,l,x']=-0.28556337398475, ['keyframe,0,pendDesiredVel,full_sit_repeat,l,z']=0.29871786126642, ['keyframe,0,pendDesiredVel,full_sit_repeat,r,x']=0.10654064391202, ['keyframe,0,pendDesiredVel,full_sit_repeat,r,z']=-0.15096356064972, ['keyframe,0,pendDesiredVel,full_sit_repeat,L1,x']=0.14121568060451, ['keyframe,0,pendDesiredVel,full_sit_repeat,L1,z']=0.13809138401541, ['keyframe,0,pendDesiredVel,full_sit_repeat,R1,x']=0.1594204914197, ['keyframe,0,pendDesiredVel,full_sit_repeat,R1,z']=-0.20363656286735, ['keyframe,0,pendDesiredVel,full_sit_repeat,L2,x']=0.11097717268466, ['keyframe,0,pendDesiredVel,full_sit_repeat,L2,z']=0.29470541742173, ['keyframe,0,pendDesiredVel,ignore,1,x']=0.16973334171348, ['keyframe,0,pendDesiredVel,ignore,1,z']=0.054908337785737, 
['keyframe,0,pendDesiredVel,ignore,0,x']=0.94446658043221, ['keyframe,0,pendDesiredVel,ignore,0,z']=-0.8059106395169, ['keyframe,0,pendDesiredVel,full_sit_repeat,l,x']=-0.28554804540745, ['keyframe,0,pendDesiredVel,full_sit_repeat,l,z']=0.29872363124168, ['keyframe,0,pendDesiredVel,full_sit_repeat,r,x']=0.10654733787361, ['keyframe,0,pendDesiredVel,full_sit_repeat,r,z']=-0.15094808631069, ['keyframe,0,pendDesiredVel,full_sit_repeat,L1,x']=0.14122504625086, ['keyframe,0,pendDesiredVel,full_sit_repeat,L1,z']=0.13809317418896, ['keyframe,0,pendDesiredVel,full_sit_repeat,R1,x']=0.1594297657949, ['keyframe,0,pendDesiredVel,full_sit_repeat,R1,z']=-0.20363300159853, ['keyframe,0,pendDesiredVel,full_sit_repeat,L2,x']=0.1109817878176, ['keyframe,0,pendDesiredVel,full_sit_repeat,L2,z']=0.29470060007313, ['keyframe,0,pendDesiredVel,ignore,1,x']=0.16973315710281, ['keyframe,0,pendDesiredVel,ignore,1,z']=0.054908259364004, 
}
useCases.full_sit_repeat.pendOptimizationPath=
{
	firstFrames={1*4,20*4,39*4,58*4,77*4,96*4,115*4,132*4},
	segments={'ignore,0','full_sit_repeat,l','full_sit_repeat,r','full_sit_repeat,L1','full_sit_repeat,R1','full_sit_repeat,L2','ignore,1'},
}
--useCases.full_sit_repeat.measureOptCost=useCases.measureOptCost

useCases.full_sit_repeat.segmentations=
{
	full_sit_repeat={
		firstFrames={1*4,20*4,39*4,58*4,77*4,96*4,115*4,132*4},
		--        (blank)    L    R     L     R     L     (blank)
		names={             'l', 'r', 'L1', 'R1', 'L2',  },
		swingL={             0,   1,   0,    1,    0,    },
		swingR={             1,   0,   1,    0,    1,    },
		footRefL= "convertFromSwingL",
		footRefR= "convertFromSwingR",
		usePositionControl=false,
	},
}
useCases.full_sit_repeat.graphParam=
{
	full_sit_repeat={
		seg={            'l',  'r',  'L1', 'R1','L'},
		num_key={         3,    3,    3  ,  4,  4},
		key_first={       0,    0,    0  ,  0,  0},
		key_last={       'r', 'L1',  'R1', 'L', 'R1'},
	},
}
useCases.full_sit_repeat.graph=
{
	{
		"addInterpolatedSegment",
		grpName="full_sit_repeat",
		name="L",
		seg0={"full_sit_repeat", "L2"},
		seg1={"full_sit_repeat", "L1"},
		startWeight=0, endWeight=1
	},
	{"connectMulti", "full_sit_repeat", "l", "r", "L1", "R1", "L", "R1"},
	--{"initialSegment", "full_sit_repeat", "l"}
	{"initialSegment", "full_sit_repeat", "R1"}
}
useCases.full_sit_repeat.segNames=
{
	"l", "r", "L1", 'R1','L',
}

do 
	useCases.full_sit_repeat.controlParam={
		['useCases,full_sit_repeat,COMobjWeight']=0, 
		['useCases,full_sit_repeat,conservativeW']=1, 
		--['useCases,full_sit_repeat,contactMargin']=0.01, 
		['useCases,full_sit_repeat,dotMomentumScale']=0.3, 
		['useCases,full_sit_repeat,excludeRoot']=true, 
		['useCases,full_sit_repeat,headControlWeight']=0, 
		['useCases,full_sit_repeat,k_d_HEAD']=14, 
		['useCases,full_sit_repeat,k_p_HEAD']=0, 
		['useCases,full_sit_repeat,k_d_EE']=24, 
		['useCases,full_sit_repeat,k_d_momentum']=10, 
		['useCases,full_sit_repeat,k_p_EE']=120, 

		--['useCases,full_sit_repeat,maxPenetratingVel']=0, 
		['useCases,full_sit_repeat,momentumThr']=50, 
		['useCases,full_sit_repeat,noComvelDependentFootAdjustment']=true, 
		['useCases,full_sit_repeat,noIntersectionPrevenction']=true, 
		['useCases,full_sit_repeat,numericalDerivDmot']=true, 
		['useCases,full_sit_repeat,perClassContactMargin']=1, 
		['useCases,full_sit_repeat,turnGain']=10, 
		['useCases,full_sit_repeat,velMarginOffset']=0, 

		['useCases,full_sit_repeat,actuationType']      = useCases.full_sit_repeat.actuationType,
		['useCases,full_sit_repeat,k_p_ID']             = useCases.full_sit_repeat.k_p_ID,
		['useCases,full_sit_repeat,k_d_ID']             = useCases.full_sit_repeat.k_d_ID,
		['useCases,full_sit_repeat,ddqObjWeight']       = useCases.full_sit_repeat.ddqObjWeight,
		['useCases,full_sit_repeat,tauObjWeight']       = useCases.full_sit_repeat.tauObjWeight,
		['useCases,full_sit_repeat,ftObjWeight']        = useCases.full_sit_repeat.ftObjWeight,
		['useCases,full_sit_repeat,aObjWeight']         = useCases.full_sit_repeat.aObjWeight,
		['useCases,full_sit_repeat,lambdaObjWeight']    = useCases.full_sit_repeat.lambdaObjWeight,
		['useCases,full_sit_repeat,EEobjWeight']        = useCases.full_sit_repeat.EEobjWeight,
		['useCases,full_sit_repeat,EEobjWeightAngular'] = useCases.full_sit_repeat.EEobjWeightAngular,
		['useCases,full_sit_repeat,momentumWeight']     = useCases.full_sit_repeat.momentumWeight,
		['useCases,full_sit_repeat,tauMax']             = useCases.full_sit_repeat.tauMax,
		['useCases,full_sit_repeat,ftMax']              = useCases.full_sit_repeat.ftMax,
	}

	local function accumulate(cp_mod)
		local useCase=useCases.full_sit_repeat
		useCases.accumulate(useCase, cp_mod)
	end

	accumulate({
		----['keyframe,0,footRmod,full_sit_repeat,l,y']  = 0.,
		----['keyframe,1,footRmod,full_sit_repeat,l,y']  = 0.05,
		--['keyframe,0,footLmod,full_sit_repeat,r,y']  = 0.0,
		--['keyframe,1,footLmod,full_sit_repeat,r,y']  = 0.2,
		--['keyframe,0,footRmod,full_sit_repeat,L1,y'] = 0.0,
		--['keyframe,1,footRmod,full_sit_repeat,L1,y'] = 0.2,
		--['map,0,swingFootMod,full_sit_repeat,y']     = 0.1,
		--['map,1,swingFootMod,full_sit_repeat,y']     = 0.2,
		--['map,2,swingFootMod,full_sit_repeat,y']     = 0.1,

		----['keyframe,0,footLmod,full_sit_repeat,l,y']  = 0.,
		----['keyframe,1,footLmod,full_sit_repeat,l,y']  = 0.,
		--['keyframe,0,footRmod,full_sit_repeat,r,y']  = 0.,
		--['keyframe,1,footRmod,full_sit_repeat,r,y']  = -.1,
		--['keyframe,0,footLmod,full_sit_repeat,L1,y'] = 0.,
		--['keyframe,1,footLmod,full_sit_repeat,L1,y'] = -.1,
		--['map,0,spprtFootMod,full_sit_repeat,y']     = 0.,
		--['map,1,spprtFootMod,full_sit_repeat,y']     = 0.,
		--['map,2,spprtFootMod,full_sit_repeat,y']     = 0.,
	})
	useCases.unmapControlParam(useCases.full_sit_repeat)

----real bestfvever 2.5443384757649e-06
--accumulate({['map,0,swingFootMod,full_lean_repeat,x']= 0.33408262441359, ['map,0,swingFootMod,full_lean_repeat,y']= -0.74997368094616, ['map,0,swingFootMod,full_lean_repeat,z']= -0.37090754316367, ['map,1,swingFootMod,full_lean_repeat,x']= 0.0010648919437325, ['map,1,swingFootMod,full_lean_repeat,y']= 0.44464021418659, ['map,1,swingFootMod,full_lean_repeat,z']= -0.12984863993139, ['map,2,swingFootMod,full_lean_repeat,x']= 0.10480837745653, ['map,2,swingFootMod,full_lean_repeat,y']= 0.40768862213177, ['map,2,swingFootMod,full_lean_repeat,z']= 0.25329181865272, ['map,0,spprtFootMod,full_lean_repeat,x']= 0.060114703831881, ['map,0,spprtFootMod,full_lean_repeat,y']= 0.23859074572314, ['map,0,spprtFootMod,full_lean_repeat,z']= -0.0076696702879601, ['map,1,spprtFootMod,full_lean_repeat,x']= 0.25927378243212, ['map,1,spprtFootMod,full_lean_repeat,y']= -0.68911387882518, ['map,1,spprtFootMod,full_lean_repeat,z']= -0.15330765121632, ['map,2,spprtFootMod,full_lean_repeat,x']= 0.15448901943291, ['map,2,spprtFootMod,full_lean_repeat,y']= -0.56126524876959, ['map,2,spprtFootMod,full_lean_repeat,z']= -0.33235175035614, })

----real bestfvever 3.2444420855398e-05
----iter 191
--accumulate({['map,0,swingFootMod,full_sit_repeat,x']= 0.081685499414168, ['map,0,swingFootMod,full_sit_repeat,y']= -0.014323119852425, ['map,0,swingFootMod,full_sit_repeat,z']= 0.022071868670535, ['map,1,swingFootMod,full_sit_repeat,x']= 0.076463001943091, ['map,1,swingFootMod,full_sit_repeat,y']= -0.21973462587759, ['map,1,swingFootMod,full_sit_repeat,z']= 0.15645739843101, ['map,2,swingFootMod,full_sit_repeat,x']= -0.011399494426433, ['map,2,swingFootMod,full_sit_repeat,y']= 0.11290307955561, ['map,2,swingFootMod,full_sit_repeat,z']= 0.044804126135473, ['map,0,spprtFootMod,full_sit_repeat,x']= 0.078677532378358, ['map,0,spprtFootMod,full_sit_repeat,y']= -0.57495160580607, ['map,0,spprtFootMod,full_sit_repeat,z']= 0.21666884369128, ['map,1,spprtFootMod,full_sit_repeat,x']= -0.16540150534871, ['map,1,spprtFootMod,full_sit_repeat,y']= -0.37653943883388, ['map,1,spprtFootMod,full_sit_repeat,z']= 0.37999993385206, ['map,2,spprtFootMod,full_sit_repeat,x']= -0.066304119744646, ['map,2,spprtFootMod,full_sit_repeat,y']= -0.40780827143804, ['map,2,spprtFootMod,full_sit_repeat,z']= -0.04816475389757, })

--real bestfvever 3.0036845446083e-05
--iter 1525
--accumulate({['map,0,swingFootMod,full_sit_repeat,x']= 0.10949665715509, ['map,0,swingFootMod,full_sit_repeat,y']= 0.041730994449181, ['map,0,swingFootMod,full_sit_repeat,z']= 0.039748423460159, ['map,1,swingFootMod,full_sit_repeat,x']= 0.16019447374441, ['map,1,swingFootMod,full_sit_repeat,y']= -0.20332186769605, ['map,1,swingFootMod,full_sit_repeat,z']= 0.1865880556125, ['map,2,swingFootMod,full_sit_repeat,x']= -0.17025597355804, ['map,2,swingFootMod,full_sit_repeat,y']= 0.19810479876754, ['map,2,swingFootMod,full_sit_repeat,z']= -0.0041439576714071, ['map,0,spprtFootMod,full_sit_repeat,x']= 0.07312530978002, ['map,0,spprtFootMod,full_sit_repeat,y']= -0.69725664772911, ['map,0,spprtFootMod,full_sit_repeat,z']= 0.31660186292933, ['map,1,spprtFootMod,full_sit_repeat,x']= -0.29807249651163, ['map,1,spprtFootMod,full_sit_repeat,y']= -0.39458777788501, ['map,1,spprtFootMod,full_sit_repeat,z']= 0.45250874292522, ['map,2,spprtFootMod,full_sit_repeat,x']= -0.029207893830193, ['map,2,spprtFootMod,full_sit_repeat,y']= -0.39596987929698, ['map,2,spprtFootMod,full_sit_repeat,z']= 0.063513779439468, })


	useCases.full_sit_repeat.initMsclForceScale=4

useCases.unmapControlParam(useCases.full_sit_repeat)
end


