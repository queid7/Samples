package.path=package.path..";../Samples/ysscripts/lib/?.lua" --;"..package.path
require("utilfunc")

package.path=package.path..";../Samples/ysscripts/samples/?.lua" --;"..package.path
require("useMuscle_g2562_gait")


useCases.g2562_lean=deepCopyTable(useCases.g2562_gait)

useCases.g2562_lean.optimizerMethod='Optimizer.methods.CMAes_ys'

--useCases.g2562_lean.endSegW=10
useCases.g2562_lean.endSegW=15
useCases.g2562_lean.prec=.2
--useCases.g2562_lean.endSegW=20
--useCases.g2562_lean.prec=.05

useCases.g2562_lean.modelName='g2562_lean'
useCases.g2562_lean.grpName='g2562_lean'
useCases.g2562_lean.grpNames={'g2562_lean'}

-- the initial pendControlParam and pendOptimizationPath can be automatically generated by using createInitialPendControlParam.lua
useCases.g2562_lean.pendControlParam=
{
['keyframe,0,pendDesiredVel,g2562_lean,l,z']=0,['keyframe,0,pendDesiredVel,g2562_lean,l,x']=1,['keyframe,0,pendDesiredVel,g2562_lean,r,z']=0,['keyframe,0,pendDesiredVel,g2562_lean,r,x']=1,['keyframe,0,pendDesiredVel,g2562_lean,L1,z']=0,['keyframe,0,pendDesiredVel,g2562_lean,L1,x']=1,['keyframe,0,pendDesiredVel,g2562_lean,R1,z']=0,['keyframe,0,pendDesiredVel,g2562_lean,R1,x']=1,['keyframe,0,pendDesiredVel,g2562_lean,L2,z']=0,['keyframe,0,pendDesiredVel,g2562_lean,L2,x']=1,['keyframe,0,pendDesiredVel,ignore,0,z']=0,['keyframe,0,pendDesiredVel,ignore,0,x']=1,['keyframe,0,pendDesiredVel,ignore,1,z']=0,['keyframe,0,pendDesiredVel,ignore,1,x']=1,
['keyframe,0,pendDesiredVel,ignore,0,x']=0.49221236658979, ['keyframe,0,pendDesiredVel,ignore,0,z']=-0.0054183433195051, ['keyframe,0,pendDesiredVel,g2562_lean,l,x']=0.65157250045983, ['keyframe,0,pendDesiredVel,g2562_lean,l,z']=-0.015155085230071, ['keyframe,0,pendDesiredVel,g2562_lean,r,x']=0.71655843417388, ['keyframe,0,pendDesiredVel,g2562_lean,r,z']=0.013602984519031, ['keyframe,0,pendDesiredVel,g2562_lean,L1,x']=0.72777850080291, ['keyframe,0,pendDesiredVel,g2562_lean,L1,z']=0.0012751554227634, ['keyframe,0,pendDesiredVel,g2562_lean,R1,x']=0.75167607322418, ['keyframe,0,pendDesiredVel,g2562_lean,R1,z']=0.0042442928911984, ['keyframe,0,pendDesiredVel,g2562_lean,L2,x']=0.84822437118635, ['keyframe,0,pendDesiredVel,g2562_lean,L2,z']=0.0019809272886494, ['keyframe,0,pendDesiredVel,ignore,1,x']=0.95788833475772, ['keyframe,0,pendDesiredVel,ignore,1,z']=-0.0022933968172409, 
['keyframe,0,pendDesiredVel,ignore,0,x']=0.49133593616463, ['keyframe,0,pendDesiredVel,ignore,0,z']=-0.0056032730252848, ['keyframe,0,pendDesiredVel,g2562_lean,l,x']=0.65042956157686, ['keyframe,0,pendDesiredVel,g2562_lean,l,z']=-0.014746146581524, ['keyframe,0,pendDesiredVel,g2562_lean,r,x']=0.71622136677421, ['keyframe,0,pendDesiredVel,g2562_lean,r,z']=0.013179046009638, ['keyframe,0,pendDesiredVel,g2562_lean,L1,x']=0.72775339291649, ['keyframe,0,pendDesiredVel,g2562_lean,L1,z']=0.0014843659503535, ['keyframe,0,pendDesiredVel,g2562_lean,R1,x']=0.75168439081034, ['keyframe,0,pendDesiredVel,g2562_lean,R1,z']=0.0040984155592843, ['keyframe,0,pendDesiredVel,g2562_lean,L2,x']=0.84768850640149, ['keyframe,0,pendDesiredVel,g2562_lean,L2,z']=0.0019755580995616, ['keyframe,0,pendDesiredVel,ignore,1,x']=0.95664000871785, ['keyframe,0,pendDesiredVel,ignore,1,z']=-0.0023169285859117, 
['keyframe,0,pendDesiredVel,ignore,0,x']=0.48802705563885, ['keyframe,0,pendDesiredVel,ignore,0,z']=-0.013954315117401, ['keyframe,0,pendDesiredVel,g2562_lean,l,x']=0.6244062987454, ['keyframe,0,pendDesiredVel,g2562_lean,l,z']=0.010725430993183, ['keyframe,0,pendDesiredVel,g2562_lean,r,x']=0.73397785100005, ['keyframe,0,pendDesiredVel,g2562_lean,r,z']=-0.010850698481838, ['keyframe,0,pendDesiredVel,g2562_lean,L1,x']=0.75669671729001, ['keyframe,0,pendDesiredVel,g2562_lean,L1,z']=0.014076689497005, ['keyframe,0,pendDesiredVel,g2562_lean,R1,x']=0.76814774166426, ['keyframe,0,pendDesiredVel,g2562_lean,R1,z']=-0.0036664352612009, ['keyframe,0,pendDesiredVel,g2562_lean,L2,x']=0.81153560827322, ['keyframe,0,pendDesiredVel,g2562_lean,L2,z']=0.0011353640524627, ['keyframe,0,pendDesiredVel,ignore,1,x']=0.86151119657935, ['keyframe,0,pendDesiredVel,ignore,1,z']=-0.0040746042475397, 
['keyframe,0,pendDesiredVel,ignore,0,x']=0.32826329649416, ['keyframe,0,pendDesiredVel,ignore,0,z']=-0.020361337351578, ['keyframe,0,pendDesiredVel,g2562_lean,l,x']=0.78980578851882, ['keyframe,0,pendDesiredVel,g2562_lean,l,z']=0.012594991591796, ['keyframe,0,pendDesiredVel,g2562_lean,r,x']=0.82464935644462, ['keyframe,0,pendDesiredVel,g2562_lean,r,z']=-0.017044485891922, ['keyframe,0,pendDesiredVel,g2562_lean,L1,x']=0.72807473607511, ['keyframe,0,pendDesiredVel,g2562_lean,L1,z']=0.019158322886792, ['keyframe,0,pendDesiredVel,g2562_lean,R1,x']=0.66823463956661, ['keyframe,0,pendDesiredVel,g2562_lean,R1,z']=-0.01967797231025, ['keyframe,0,pendDesiredVel,g2562_lean,L2,x']=0.74525381662103, ['keyframe,0,pendDesiredVel,g2562_lean,L2,z']=0.029616694904189, ['keyframe,0,pendDesiredVel,ignore,1,x']=0.85394965549782, ['keyframe,0,pendDesiredVel,ignore,1,z']=0.0024231764523249, 
['keyframe,0,pendDesiredVel,ignore,0,x']=0.32812626917668, ['keyframe,0,pendDesiredVel,ignore,0,z']=-0.020362836187669, ['keyframe,0,pendDesiredVel,g2562_lean,l,x']=0.78974011156082, ['keyframe,0,pendDesiredVel,g2562_lean,l,z']=0.012621619635358, ['keyframe,0,pendDesiredVel,g2562_lean,r,x']=0.82453552568791, ['keyframe,0,pendDesiredVel,g2562_lean,r,z']=-0.017013549388808, ['keyframe,0,pendDesiredVel,g2562_lean,L1,x']=0.72801863505382, ['keyframe,0,pendDesiredVel,g2562_lean,L1,z']=0.019209591407334, ['keyframe,0,pendDesiredVel,g2562_lean,R1,x']=0.66823749390296, ['keyframe,0,pendDesiredVel,g2562_lean,R1,z']=-0.019651544477381, ['keyframe,0,pendDesiredVel,g2562_lean,L2,x']=0.74526914597701, ['keyframe,0,pendDesiredVel,g2562_lean,L2,z']=0.029643127314895, ['keyframe,0,pendDesiredVel,ignore,1,x']=0.85394883070678, ['keyframe,0,pendDesiredVel,ignore,1,z']=0.0024275502981052, 
['keyframe,0,pendDesiredVel,ignore,0,x']=0.32811222428954, ['keyframe,0,pendDesiredVel,ignore,0,z']=-0.020363146345834, ['keyframe,0,pendDesiredVel,g2562_lean,l,x']=0.78973364097969, ['keyframe,0,pendDesiredVel,g2562_lean,l,z']=0.012624292523184, ['keyframe,0,pendDesiredVel,g2562_lean,r,x']=0.82452380445559, ['keyframe,0,pendDesiredVel,g2562_lean,r,z']=-0.017010364754889, ['keyframe,0,pendDesiredVel,g2562_lean,L1,x']=0.72801296566233, ['keyframe,0,pendDesiredVel,g2562_lean,L1,z']=0.01921495997783, ['keyframe,0,pendDesiredVel,g2562_lean,R1,x']=0.66823800490074, ['keyframe,0,pendDesiredVel,g2562_lean,R1,z']=-0.0196487788972, ['keyframe,0,pendDesiredVel,g2562_lean,L2,x']=0.7452708599926, ['keyframe,0,pendDesiredVel,g2562_lean,L2,z']=0.029645930886528, ['keyframe,0,pendDesiredVel,ignore,1,x']=0.85394874547131, ['keyframe,0,pendDesiredVel,ignore,1,z']=0.0024280180154946, 
}
useCases.g2562_lean.pendOptimizationPath=
{
	firstFrames={1*4,21*4,41*4,61*4,81*4,101*4,121*4,139*4},
	segments={'ignore,0','g2562_lean,l','g2562_lean,r','g2562_lean,L1','g2562_lean,R1','g2562_lean,L2','ignore,1'},
}
--useCases.g2562_lean.measureOptCost=useCases.measureOptCost

useCases.g2562_lean.segmentations=
{
	g2562_lean={
		firstFrames={1*4,21*4,41*4,61*4,81*4,101*4,121*4,139*4},
		--        (blank)    L    R     L     R     L     (blank)
		names={             'l', 'r', 'L1', 'R1', 'L2',  },
		swingL={             0,   1,   0,    1,    0,    },
		swingR={             1,   0,   1,    0,    1,    },
		footRefL= "convertFromSwingL",
		footRefR= "convertFromSwingR",
		usePositionControl=false,
	},
}
useCases.g2562_lean.graphParam=
{
	g2562_lean={
		seg={            'l',  'r',  'L1', 'R1','L'},
		num_key={         3,    3,    3  ,  4,  4},
		key_first={       0,    0,    0  ,  0,  0},
		key_last={       'r', 'L1',  'R1', 'L', 'R1'},
	},
}
useCases.g2562_lean.graph=
{
	{
		"addInterpolatedSegment",
		grpName="g2562_lean",
		name="L",
		seg0={"g2562_lean", "L2"},
		seg1={"g2562_lean", "L1"},
		startWeight=0, endWeight=1
	},
	{"connectMulti", "g2562_lean", "l", "r", "L1", "R1", "L", "R1"},
	--{"initialSegment", "g2562_lean", "l"}
	{"initialSegment", "g2562_lean", "R1"}
}
useCases.g2562_lean.segNames=
{
	"l", "r", "L1", 'R1','L',
}

do 
	useCases.g2562_lean.controlParam={
		['useCases,g2562_lean,COMobjWeight']=0, 
		['useCases,g2562_lean,conservativeW']=1, 
		--['useCases,g2562_lean,contactMargin']=0.01, 
		['useCases,g2562_lean,dotMomentumScale']=0.3, 
		['useCases,g2562_lean,excludeRoot']=true, 
		['useCases,g2562_lean,headControlWeight']=0, 
		['useCases,g2562_lean,k_d_HEAD']=14, 
		['useCases,g2562_lean,k_p_HEAD']=0, 
		['useCases,g2562_lean,k_d_EE']=24, 
		['useCases,g2562_lean,k_d_momentum']=10, 
		['useCases,g2562_lean,k_p_EE']=120, 

		--['useCases,g2562_lean,maxPenetratingVel']=0, 
		['useCases,g2562_lean,momentumThr']=50, 
		['useCases,g2562_lean,noComvelDependentFootAdjustment']=true, 
		['useCases,g2562_lean,noIntersectionPrevenction']=true, 
		['useCases,g2562_lean,numericalDerivDmot']=true, 
		['useCases,g2562_lean,perClassContactMargin']=1, 
		['useCases,g2562_lean,turnGain']=10, 
		['useCases,g2562_lean,velMarginOffset']=0, 

		['useCases,g2562_lean,actuationType']      = useCases.g2562_lean.actuationType,
		['useCases,g2562_lean,k_p_ID']             = useCases.g2562_lean.k_p_ID,
		['useCases,g2562_lean,k_d_ID']             = useCases.g2562_lean.k_d_ID,
		['useCases,g2562_lean,ddqObjWeight']       = useCases.g2562_lean.ddqObjWeight,
		['useCases,g2562_lean,tauObjWeight']       = useCases.g2562_lean.tauObjWeight,
		['useCases,g2562_lean,ftObjWeight']        = useCases.g2562_lean.ftObjWeight,
		['useCases,g2562_lean,aObjWeight']         = useCases.g2562_lean.aObjWeight,
		['useCases,g2562_lean,lambdaObjWeight']    = useCases.g2562_lean.lambdaObjWeight,
		['useCases,g2562_lean,EEobjWeight']        = useCases.g2562_lean.EEobjWeight,
		['useCases,g2562_lean,EEobjWeightAngular'] = useCases.g2562_lean.EEobjWeightAngular,
		['useCases,g2562_lean,momentumWeight']     = useCases.g2562_lean.momentumWeight,
		['useCases,g2562_lean,tauMax']             = useCases.g2562_lean.tauMax,
		['useCases,g2562_lean,ftMax']              = useCases.g2562_lean.ftMax,
	}

	local function accumulate(cp_mod)
		local useCase=useCases.g2562_lean
		useCases.accumulate(useCase, cp_mod)
	end

	accumulate({
		----['keyframe,0,footRmod,g2562_lean,l,y']  = 0.,
		----['keyframe,1,footRmod,g2562_lean,l,y']  = 0.05,
		--['keyframe,0,footLmod,g2562_lean,r,y']  = 0.0,
		--['keyframe,1,footLmod,g2562_lean,r,y']  = 0.2,
		--['keyframe,0,footRmod,g2562_lean,L1,y'] = 0.0,
		--['keyframe,1,footRmod,g2562_lean,L1,y'] = 0.2,
		--['map,0,swingFootMod,g2562_lean,y']     = 0.1,
		--['map,1,swingFootMod,g2562_lean,y']     = 0.2,
		--['map,2,swingFootMod,g2562_lean,y']     = 0.1,

		----['keyframe,0,footLmod,g2562_lean,l,y']  = 0.,
		----['keyframe,1,footLmod,g2562_lean,l,y']  = 0.,
		--['keyframe,0,footRmod,g2562_lean,r,y']  = 0.,
		--['keyframe,1,footRmod,g2562_lean,r,y']  = -.1,
		--['keyframe,0,footLmod,g2562_lean,L1,y'] = 0.,
		--['keyframe,1,footLmod,g2562_lean,L1,y'] = -.1,
		--['map,0,spprtFootMod,g2562_lean,y']     = 0.,
		--['map,1,spprtFootMod,g2562_lean,y']     = 0.,
		--['map,2,spprtFootMod,g2562_lean,y']     = 0.,
	})
	useCases.unmapControlParam(useCases.g2562_lean)


-------------------------------------------------
if g_mode=='default' then
	--iter:352 bestfvever:1.8428771956957e-06
	accumulate({['map,0,swingFootMod,g2562_lean,x']= 0.027328100046528, ['map,0,swingFootMod,g2562_lean,y']= -0.27387703136969, ['map,0,swingFootMod,g2562_lean,z']= 0.13436014952676, ['map,1,swingFootMod,g2562_lean,x']= 0.038467398933674, ['map,1,swingFootMod,g2562_lean,y']= 0.21648652861648, ['map,1,swingFootMod,g2562_lean,z']= 0.21181269627101, ['map,2,swingFootMod,g2562_lean,x']= -0.22081323018266, ['map,2,swingFootMod,g2562_lean,y']= 0.024520386993675, ['map,2,swingFootMod,g2562_lean,z']= 0.080873466295797, ['map,0,spprtFootMod,g2562_lean,x']= 0.23303170205706, ['map,0,spprtFootMod,g2562_lean,y']= -0.16476914944663, ['map,0,spprtFootMod,g2562_lean,z']= 0.14673918324037, ['map,1,spprtFootMod,g2562_lean,x']= -0.11357239651324, ['map,1,spprtFootMod,g2562_lean,y']= 0.15956485894606, ['map,1,spprtFootMod,g2562_lean,z']= -0.080550759274068, ['map,2,spprtFootMod,g2562_lean,x']= -0.17997629367993, ['map,2,spprtFootMod,g2562_lean,y']= -0.040685310068659, ['map,2,spprtFootMod,g2562_lean,z']= -0.051005677471189, })

elseif g_mode=='a1' then
	useCases.g2562_lean.aObjWeight = 1*useCases.g2562_lean.aObjWeight

	--iter:206 bestfvever:1.3746653532493e-06
	accumulate({['map,0,swingFootMod,g2562_lean,x']= 0.1482553576519, ['map,0,swingFootMod,g2562_lean,y']= -0.14043643908872, ['map,0,swingFootMod,g2562_lean,z']= -0.0058208223566406, ['map,1,swingFootMod,g2562_lean,x']= 0.11793242350097, ['map,1,swingFootMod,g2562_lean,y']= -0.15101378097983, ['map,1,swingFootMod,g2562_lean,z']= 0.37739501217747, ['map,2,swingFootMod,g2562_lean,x']= -0.21428212397326, ['map,2,swingFootMod,g2562_lean,y']= 0.33561196648179, ['map,2,swingFootMod,g2562_lean,z']= 0.091727748159517, ['map,0,spprtFootMod,g2562_lean,x']= 0.21075074142555, ['map,0,spprtFootMod,g2562_lean,y']= -0.13793111837049, ['map,0,spprtFootMod,g2562_lean,z']= 0.14791693825888, ['map,1,spprtFootMod,g2562_lean,x']= -0.073916477593328, ['map,1,spprtFootMod,g2562_lean,y']= 0.21994076918271, ['map,1,spprtFootMod,g2562_lean,z']= -0.039475203036556, ['map,2,spprtFootMod,g2562_lean,x']= -0.062056361615281, ['map,2,spprtFootMod,g2562_lean,y']= -0.1295600648557, ['map,2,spprtFootMod,g2562_lean,z']= -0.26853685683154, })

elseif g_mode=='a_.1' then
	useCases.g2562_lean.aObjWeight = .1*useCases.g2562_lean.aObjWeight

	--iter:221 bestfvever:6.752463186246e-07
	accumulate({['map,0,swingFootMod,g2562_lean,x']= -0.0545477658361, ['map,0,swingFootMod,g2562_lean,y']= -0.22590861466436, ['map,0,swingFootMod,g2562_lean,z']= 0.012813438927016, ['map,1,swingFootMod,g2562_lean,x']= 0.250566426078, ['map,1,swingFootMod,g2562_lean,y']= -0.0056341790363265, ['map,1,swingFootMod,g2562_lean,z']= 0.12193330624386, ['map,2,swingFootMod,g2562_lean,x']= -0.19909646569536, ['map,2,swingFootMod,g2562_lean,y']= 0.35768193805147, ['map,2,swingFootMod,g2562_lean,z']= 0.058399908167693, ['map,0,spprtFootMod,g2562_lean,x']= 0.12626475558899, ['map,0,spprtFootMod,g2562_lean,y']= -0.19331613865419, ['map,0,spprtFootMod,g2562_lean,z']= 0.094895139274854, ['map,1,spprtFootMod,g2562_lean,x']= 0.18385420982316, ['map,1,spprtFootMod,g2562_lean,y']= 0.1205709397605, ['map,1,spprtFootMod,g2562_lean,z']= 0.033595889095061, ['map,2,spprtFootMod,g2562_lean,x']= -0.088219736414376, ['map,2,spprtFootMod,g2562_lean,y']= -0.037760038195698, ['map,2,spprtFootMod,g2562_lean,z']= -0.16825957623469, })

	useCases.g2562_lean.endSegW=20
	useCases.g2562_lean.prec=.05

	--iter:67 bestfvever:5.8040587912062e-07
	accumulate({['map,0,swingFootMod,g2562_lean,x']= -0.032963469301321, ['map,0,swingFootMod,g2562_lean,y']= -0.20655981689199, ['map,0,swingFootMod,g2562_lean,z']= -0.040450017832581, ['map,1,swingFootMod,g2562_lean,x']= 0.23351737409205, ['map,1,swingFootMod,g2562_lean,y']= -0.051131781832952, ['map,1,swingFootMod,g2562_lean,z']= 0.14840299943256, ['map,2,swingFootMod,g2562_lean,x']= -0.22161168310555, ['map,2,swingFootMod,g2562_lean,y']= 0.39097412098107, ['map,2,swingFootMod,g2562_lean,z']= 0.070934068777981, ['map,0,spprtFootMod,g2562_lean,x']= 0.14346857043486, ['map,0,spprtFootMod,g2562_lean,y']= -0.22794890232484, ['map,0,spprtFootMod,g2562_lean,z']= 0.072010516496556, ['map,1,spprtFootMod,g2562_lean,x']= 0.15551433731699, ['map,1,spprtFootMod,g2562_lean,y']= 0.14316924154252, ['map,1,spprtFootMod,g2562_lean,z']= -0.005666295561009, ['map,2,spprtFootMod,g2562_lean,x']= -0.019662884928173, ['map,2,spprtFootMod,g2562_lean,y']= -0.071530460189336, ['map,2,spprtFootMod,g2562_lean,z']= -0.17160975013912, })

elseif g_mode=='a_.01' then
	useCases.g2562_lean.aObjWeight = .01*useCases.g2562_lean.aObjWeight

end
-------------------------------------------------

useCases.g2562_lean.controlParam['useCases,g2562_lean,aObjWeight'] = useCases.g2562_lean.aObjWeight

useCases.unmapControlParam(useCases.g2562_lean)
end


