package.path=package.path..";../Samples/ysscripts/lib/?.lua" --;"..package.path
require("utilfunc")

package.path=package.path..";../Samples/ysscripts/samples/?.lua" --;"..package.path
require("useMuscle_g2562_gait")


useCases.g2562_ipnrun=deepCopyTable(useCases.g2562_gait)

useCases.g2562_ipnrun.optimizerMethod='Optimizer.methods.CMAes_ys'

useCases.g2562_ipnrun.endSegW=15
useCases.g2562_ipnrun.prec=.2

useCases.g2562_ipnrun.modelName='g2562_ipnrun'
useCases.g2562_ipnrun.grpName='g2562_ipnrun'
useCases.g2562_ipnrun.grpNames={'g2562_ipnrun'}

-- the initial pendControlParam and pendOptimizationPath can be automatically generated by using createInitialPendControlParam.lua
useCases.g2562_ipnrun.pendControlParam=
{
['keyframe,0,pendDesiredVel,g2562_ipnrun,l,z']=0,['keyframe,0,pendDesiredVel,g2562_ipnrun,l,x']=1,['keyframe,0,pendDesiredVel,g2562_ipnrun,r,z']=0,['keyframe,0,pendDesiredVel,g2562_ipnrun,r,x']=1,['keyframe,0,pendDesiredVel,g2562_ipnrun,L1,z']=0,['keyframe,0,pendDesiredVel,g2562_ipnrun,L1,x']=1,['keyframe,0,pendDesiredVel,g2562_ipnrun,R1,z']=0,['keyframe,0,pendDesiredVel,g2562_ipnrun,R1,x']=1,['keyframe,0,pendDesiredVel,g2562_ipnrun,L2,z']=0,['keyframe,0,pendDesiredVel,g2562_ipnrun,L2,x']=1,['keyframe,0,pendDesiredVel,ignore,0,z']=0,['keyframe,0,pendDesiredVel,ignore,0,x']=1,['keyframe,0,pendDesiredVel,ignore,1,z']=0,['keyframe,0,pendDesiredVel,ignore,1,x']=1,
['keyframe,0,pendDesiredVel,ignore,0,x']=-0.17735172913339, ['keyframe,0,pendDesiredVel,ignore,0,z']=-0.33965287312438, ['keyframe,0,pendDesiredVel,g2562_ipnrun,l,x']=-0.11175535491193, ['keyframe,0,pendDesiredVel,g2562_ipnrun,l,z']=-0.20509580349014, ['keyframe,0,pendDesiredVel,g2562_ipnrun,r,x']=-0.045611959285589, ['keyframe,0,pendDesiredVel,g2562_ipnrun,r,z']=-0.064245770504627, ['keyframe,0,pendDesiredVel,g2562_ipnrun,L1,x']=-0.023844434226709, ['keyframe,0,pendDesiredVel,g2562_ipnrun,L1,z']=0.011162735538263, ['keyframe,0,pendDesiredVel,g2562_ipnrun,R1,x']=-0.0056331521215652, ['keyframe,0,pendDesiredVel,g2562_ipnrun,R1,z']=0.026891966591253, ['keyframe,0,pendDesiredVel,g2562_ipnrun,L2,x']=-0.00010924919732216, ['keyframe,0,pendDesiredVel,g2562_ipnrun,L2,z']=0.018318335426283, ['keyframe,0,pendDesiredVel,ignore,1,x']=0.013336381211348, ['keyframe,0,pendDesiredVel,ignore,1,z']=-0.0029906216517521, 
['keyframe,0,pendDesiredVel,ignore,0,x']=-0.17824080838936, ['keyframe,0,pendDesiredVel,ignore,0,z']=-0.3410809987529, ['keyframe,0,pendDesiredVel,g2562_ipnrun,l,x']=-0.11309968190758, ['keyframe,0,pendDesiredVel,g2562_ipnrun,l,z']=-0.20232834162019, ['keyframe,0,pendDesiredVel,g2562_ipnrun,r,x']=-0.045167096820206, ['keyframe,0,pendDesiredVel,g2562_ipnrun,r,z']=-0.066667016742514, ['keyframe,0,pendDesiredVel,g2562_ipnrun,L1,x']=-0.024279685963021, ['keyframe,0,pendDesiredVel,g2562_ipnrun,L1,z']=0.012917961706282, ['keyframe,0,pendDesiredVel,g2562_ipnrun,R1,x']=-0.0057723312734285, ['keyframe,0,pendDesiredVel,g2562_ipnrun,R1,z']=0.026046475207172, ['keyframe,0,pendDesiredVel,g2562_ipnrun,L2,x']=-0.0014349880582403, ['keyframe,0,pendDesiredVel,g2562_ipnrun,L2,z']=0.016707604628142, ['keyframe,0,pendDesiredVel,ignore,1,x']=0.010394389636722, ['keyframe,0,pendDesiredVel,ignore,1,z']=-0.0015035794840436, 
['keyframe,0,pendDesiredVel,ignore,0,x']=-0.397279179851, ['keyframe,0,pendDesiredVel,ignore,0,z']=-0.82274789081989, ['keyframe,0,pendDesiredVel,g2562_ipnrun,l,x']=-0.1910192298709, ['keyframe,0,pendDesiredVel,g2562_ipnrun,l,z']=0.38718433951502, ['keyframe,0,pendDesiredVel,g2562_ipnrun,r,x']=0.14860475551525, ['keyframe,0,pendDesiredVel,g2562_ipnrun,r,z']=-0.080572405587164, ['keyframe,0,pendDesiredVel,g2562_ipnrun,L1,x']=-0.1010276534494, ['keyframe,0,pendDesiredVel,g2562_ipnrun,L1,z']=0.037894027131615, ['keyframe,0,pendDesiredVel,g2562_ipnrun,R1,x']=-0.05500537391832, ['keyframe,0,pendDesiredVel,g2562_ipnrun,R1,z']=-0.12241845390729, ['keyframe,0,pendDesiredVel,g2562_ipnrun,L2,x']=-0.038050607607384, ['keyframe,0,pendDesiredVel,g2562_ipnrun,L2,z']=0.080346028657179, ['keyframe,0,pendDesiredVel,ignore,1,x']=0.012218459579621, ['keyframe,0,pendDesiredVel,ignore,1,z']=0.0037180977593758, 
['keyframe,0,pendDesiredVel,ignore,0,x']=-0.3975079693686, ['keyframe,0,pendDesiredVel,ignore,0,z']=-0.82277135460157, ['keyframe,0,pendDesiredVel,g2562_ipnrun,l,x']=-0.19122548038973, ['keyframe,0,pendDesiredVel,g2562_ipnrun,l,z']=0.38723548696006, ['keyframe,0,pendDesiredVel,g2562_ipnrun,r,x']=0.14848274796588, ['keyframe,0,pendDesiredVel,g2562_ipnrun,r,z']=-0.080591733721695, ['keyframe,0,pendDesiredVel,g2562_ipnrun,L1,x']=-0.10114077401849, ['keyframe,0,pendDesiredVel,g2562_ipnrun,L1,z']=0.037933473140123, ['keyframe,0,pendDesiredVel,g2562_ipnrun,R1,x']=-0.055021577194304, ['keyframe,0,pendDesiredVel,g2562_ipnrun,R1,z']=-0.12237803749991, ['keyframe,0,pendDesiredVel,g2562_ipnrun,L2,x']=-0.038066635269741, ['keyframe,0,pendDesiredVel,g2562_ipnrun,L2,z']=0.080395541180602, ['keyframe,0,pendDesiredVel,ignore,1,x']=0.012219208654909, ['keyframe,0,pendDesiredVel,ignore,1,z']=0.0037199071894178, 
}
useCases.g2562_ipnrun.pendOptimizationPath=
{
	firstFrames={1*4,14*4,27*4,40*4,53*4,66*4,79*4,90*4},
	segments={'ignore,0','g2562_ipnrun,l','g2562_ipnrun,r','g2562_ipnrun,L1','g2562_ipnrun,R1','g2562_ipnrun,L2','ignore,1'},
}
--useCases.g2562_ipnrun.measureOptCost=useCases.measureOptCost

useCases.g2562_ipnrun.segmentations=
{
	g2562_ipnrun={
		firstFrames={1*4,14*4,27*4,40*4,53*4,66*4,79*4,90*4},
		--        (blank)    L    R     L     R     L     (blank)
		names={             'l', 'r', 'L1', 'R1', 'L2',  },
		swingL={             0,   1,   0,    1,    0,    },
		swingR={             1,   0,   1,    0,    1,    },
		footRefL= "convertFromSwingL",
		footRefR= "convertFromSwingR",
		usePositionControl=false,
	},
}
useCases.g2562_ipnrun.graphParam=
{
	g2562_ipnrun={
		seg={            'l',  'r',  'L1', 'R1','L'},
		num_key={         3,    3,    3  ,  4,  4},
		key_first={       0,    0,    0  ,  0,  0},
		key_last={       'r', 'L1',  'R1', 'L', 'R1'},
	},
}
useCases.g2562_ipnrun.graph=
{
	{
		"addInterpolatedSegment",
		grpName="g2562_ipnrun",
		name="L",
		seg0={"g2562_ipnrun", "L2"},
		seg1={"g2562_ipnrun", "L1"},
		startWeight=0, endWeight=1
	},
	{"connectMulti", "g2562_ipnrun", "l", "r", "L1", "R1", "L", "R1"},
	--{"initialSegment", "g2562_ipnrun", "l"}
	{"initialSegment", "g2562_ipnrun", "R1"}
}
useCases.g2562_ipnrun.segNames=
{
	"l", "r", "L1", 'R1','L',
}

do 
	useCases.g2562_ipnrun.controlParam={
		['useCases,g2562_ipnrun,COMobjWeight']=0, 
		['useCases,g2562_ipnrun,conservativeW']=1, 
		--['useCases,g2562_ipnrun,contactMargin']=0.01, 
		['useCases,g2562_ipnrun,dotMomentumScale']=0.3, 
		['useCases,g2562_ipnrun,excludeRoot']=true, 
		['useCases,g2562_ipnrun,headControlWeight']=0, 
		['useCases,g2562_ipnrun,k_d_HEAD']=14, 
		['useCases,g2562_ipnrun,k_p_HEAD']=0, 
		['useCases,g2562_ipnrun,k_d_EE']=24, 
		['useCases,g2562_ipnrun,k_d_momentum']=10, 
		['useCases,g2562_ipnrun,k_p_EE']=120, 

		--['useCases,g2562_ipnrun,maxPenetratingVel']=0, 
		['useCases,g2562_ipnrun,momentumThr']=50, 
		['useCases,g2562_ipnrun,noComvelDependentFootAdjustment']=true, 
		['useCases,g2562_ipnrun,noIntersectionPrevenction']=true, 
		['useCases,g2562_ipnrun,numericalDerivDmot']=true, 
		['useCases,g2562_ipnrun,perClassContactMargin']=1, 
		['useCases,g2562_ipnrun,turnGain']=10, 
		['useCases,g2562_ipnrun,velMarginOffset']=0, 

		['useCases,g2562_ipnrun,actuationType']      = useCases.g2562_ipnrun.actuationType,
		['useCases,g2562_ipnrun,k_p_ID']             = useCases.g2562_ipnrun.k_p_ID,
		['useCases,g2562_ipnrun,k_d_ID']             = useCases.g2562_ipnrun.k_d_ID,
		['useCases,g2562_ipnrun,ddqObjWeight']       = useCases.g2562_ipnrun.ddqObjWeight,
		['useCases,g2562_ipnrun,tauObjWeight']       = useCases.g2562_ipnrun.tauObjWeight,
		['useCases,g2562_ipnrun,ftObjWeight']        = useCases.g2562_ipnrun.ftObjWeight,
		['useCases,g2562_ipnrun,aObjWeight']         = useCases.g2562_ipnrun.aObjWeight,
		['useCases,g2562_ipnrun,lambdaObjWeight']    = useCases.g2562_ipnrun.lambdaObjWeight,
		['useCases,g2562_ipnrun,EEobjWeight']        = useCases.g2562_ipnrun.EEobjWeight,
		['useCases,g2562_ipnrun,EEobjWeightAngular'] = useCases.g2562_ipnrun.EEobjWeightAngular,
		['useCases,g2562_ipnrun,momentumWeight']     = useCases.g2562_ipnrun.momentumWeight,
		['useCases,g2562_ipnrun,tauMax']             = useCases.g2562_ipnrun.tauMax,
		['useCases,g2562_ipnrun,ftMax']              = useCases.g2562_ipnrun.ftMax,
	}

	local function accumulate(cp_mod)
		local useCase=useCases.g2562_ipnrun
		useCases.accumulate(useCase, cp_mod)
	end

-------------------------------------------------
if g_mode=='default' then

elseif g_mode=='a_.1' then
	useCases.g2562_ipnrun.aObjWeight = .1*useCases.g2562_ipnrun.aObjWeight

elseif g_mode=='a_.01' then
	useCases.g2562_ipnrun.aObjWeight = .01*useCases.g2562_ipnrun.aObjWeight

	--iter:224 bestfvever:1.1989806963563e-06
	accumulate({['map,0,swingFootMod,g2562_ipnrun,x']= -0.091233997966596, ['map,0,swingFootMod,g2562_ipnrun,y']= 0.23131600234488, ['map,0,swingFootMod,g2562_ipnrun,z']= 0.17655104837537, ['map,1,swingFootMod,g2562_ipnrun,x']= -0.024542888407646, ['map,1,swingFootMod,g2562_ipnrun,y']= 0.060603300282211, ['map,1,swingFootMod,g2562_ipnrun,z']= -0.047930479017579, ['map,2,swingFootMod,g2562_ipnrun,x']= 0.14306317747859, ['map,2,swingFootMod,g2562_ipnrun,y']= -0.53901764862647, ['map,2,swingFootMod,g2562_ipnrun,z']= 0.10301320467245, ['map,0,spprtFootMod,g2562_ipnrun,x']= 0.14395290675204, ['map,0,spprtFootMod,g2562_ipnrun,y']= -0.46498298474521, ['map,0,spprtFootMod,g2562_ipnrun,z']= 0.091404253488486, ['map,1,spprtFootMod,g2562_ipnrun,x']= 0.25919401564301, ['map,1,spprtFootMod,g2562_ipnrun,y']= -0.005095017489791, ['map,1,spprtFootMod,g2562_ipnrun,z']= -0.015910050547453, ['map,2,spprtFootMod,g2562_ipnrun,x']= 0.11561056241218, ['map,2,spprtFootMod,g2562_ipnrun,y']= -0.42003422581688, ['map,2,spprtFootMod,g2562_ipnrun,z']= -0.33199977401242, })

	useCases.g2562_ipnrun.endSegW=20
	useCases.g2562_ipnrun.prec=.05
	--iter:95 bestfvever:1.0853584316413e-06
	accumulate({['map,0,swingFootMod,g2562_ipnrun,x']= -0.11376487522699, ['map,0,swingFootMod,g2562_ipnrun,y']= 0.26417773054425, ['map,0,swingFootMod,g2562_ipnrun,z']= 0.1890841565412, ['map,1,swingFootMod,g2562_ipnrun,x']= -0.025182511772452, ['map,1,swingFootMod,g2562_ipnrun,y']= 0.04643529155778, ['map,1,swingFootMod,g2562_ipnrun,z']= -0.035149058580187, ['map,2,swingFootMod,g2562_ipnrun,x']= 0.15587863040323, ['map,2,swingFootMod,g2562_ipnrun,y']= -0.53120445489339, ['map,2,swingFootMod,g2562_ipnrun,z']= 0.09643536492104, ['map,0,spprtFootMod,g2562_ipnrun,x']= 0.15765934808912, ['map,0,spprtFootMod,g2562_ipnrun,y']= -0.45475310789685, ['map,0,spprtFootMod,g2562_ipnrun,z']= 0.10048045628037, ['map,1,spprtFootMod,g2562_ipnrun,x']= 0.28888942876538, ['map,1,spprtFootMod,g2562_ipnrun,y']= -0.010779933517717, ['map,1,spprtFootMod,g2562_ipnrun,z']= 0.0086368740502658, ['map,2,spprtFootMod,g2562_ipnrun,x']= 0.13273070514613, ['map,2,spprtFootMod,g2562_ipnrun,y']= -0.40526113973839, ['map,2,spprtFootMod,g2562_ipnrun,z']= -0.32112721294605, })

elseif g_mode=='a_.01_mscl_2x' then
	useCases.g2562_ipnrun.aObjWeight = .01*useCases.g2562_ipnrun.aObjWeight
	useCases.g2562_ipnrun.initMsclForceScale=2

	--iter:261 bestfvever:6.6977975285999e-07
	accumulate({['map,0,swingFootMod,g2562_ipnrun,x']= 0.012389848070785, ['map,0,swingFootMod,g2562_ipnrun,y']= -0.0036758927657317, ['map,0,swingFootMod,g2562_ipnrun,z']= 0.23331867093989, ['map,1,swingFootMod,g2562_ipnrun,x']= -0.1023122229504, ['map,1,swingFootMod,g2562_ipnrun,y']= 0.056866716411462, ['map,1,swingFootMod,g2562_ipnrun,z']= 0.11804987757804, ['map,2,swingFootMod,g2562_ipnrun,x']= 0.003811758924279, ['map,2,swingFootMod,g2562_ipnrun,y']= -0.42826517616624, ['map,2,swingFootMod,g2562_ipnrun,z']= 0.084887653643541, ['map,0,spprtFootMod,g2562_ipnrun,x']= -0.098512622461465, ['map,0,spprtFootMod,g2562_ipnrun,y']= -0.41623636867423, ['map,0,spprtFootMod,g2562_ipnrun,z']= 0.19904824283464, ['map,1,spprtFootMod,g2562_ipnrun,x']= 0.015898172956675, ['map,1,spprtFootMod,g2562_ipnrun,y']= -0.27298635584374, ['map,1,spprtFootMod,g2562_ipnrun,z']= 0.17199061166629, ['map,2,spprtFootMod,g2562_ipnrun,x']= -0.0076104980638455, ['map,2,spprtFootMod,g2562_ipnrun,y']= -0.063146251287712, ['map,2,spprtFootMod,g2562_ipnrun,z']= 0.024123625895607, })

end
-------------------------------------------------

useCases.g2562_ipnrun.controlParam['useCases,g2562_ipnrun,aObjWeight'] = useCases.g2562_ipnrun.aObjWeight

useCases.unmapControlParam(useCases.g2562_ipnrun)
end


